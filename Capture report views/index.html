<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Capture Report Views</title>

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
  <link rel="stylesheet" href="/UHCapp/Capture%20report%20views/css/header.css">
  <link rel="stylesheet" href="/UHCapp/Capture%20report%20views/css/content.css">
  <link rel="stylesheet" href="/UHCapp/Capture%20report%20views/css/report.css">
  <link rel="stylesheet" href="/UHCapp/Capture%20report%20views/css/modal.css">
  <link rel="stylesheet" href="/UHCapp/Capture%20report%20views/css/sidebar.css">
</head>
<body>
  <div id="wrapper">
    <header id="contoso-header">
      <img src="/UHCapp/Capture%20report%20views/img/IconUnitedHealthcare.png" id="contoso" alt="UnitedHealthcare logo" />
      <span id="uhc-text">United Healthcare</span>
    </header>

    <nav id="sidebar">
      <a href="/UHCapp/Go%20from%20insights%20to%20quick%20action/">Go from Insights to Quick Action</a>
      <a href="/UHCapp/Capture%20report%20views/" class="active">Capture Report Views</a>
      <a href="/UHCapp/Customize%20report%20colors%20and%20mode/">Customize Report Colors and Mode</a>
      <a href="/UHCapp/Personalize%20top%20insights/">Personalize Top Insights</a>
      <a href="/UHCapp/Quickly%20create%20and%20personalize%20visuals/">Quickly Create and Personalize Visuals</a>
    </nav>

    <main id="main-div">
      <div class="interactive-buttons">
        <div class="bookmarks-dropdown">
          <button class="btn btn-action" type="button" id="display-btn" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            <img class="btn-img" src="/UHCapp/Capture%20report%20views/img/allviews.svg" alt="My views">Saved Views
          </button>
          <ul class="dropdown-menu checkbox-menu allow-focus" role="menu" id="bookmarks-list"></ul>
        </div>
        <div>
          <button class="btn btn-action" type="button" id="capture-btn" data-toggle="modal" data-target="#modal-action">
            <img class="btn-img" src="/UHCapp/Capture%20report%20views/img/captureview.svg" alt="Capture View">Capture View
          </button>
        </div>
      </div>

      <div role="separator" class="line"></div>
      <div id="overlay">
        <img src="/UHCapp/Capture%20report%20views/img/spinner.svg" id="spinner" class="rotate" alt="Loading report">
      </div>

      <div id="report-container"></div>
    </main>
  </div>

  <!-- Modal -->
  <div class="modal fade" id="modal-action" role="dialog">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">What would you like to do with this view?</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <img src="/UHCapp/Capture%20report%20views/img/cross.svg" alt="Close">
          </button>
        </div>
        <div class="modal-body">
          <button class="btn-modal btn-links btn-active" id="save-view-btn">Save to 'My Views'</button>
          <button class="btn-modal btn-links" id="copy-link-btn">Copy Link</button>
          <div id="save-view-div">
            <label for="viewname">Enter a name for this view:</label>
            <input type="text" id="viewname" placeholder="Example: Sales Report Q1">
            <button id="save-bookmark-btn">Save</button>
          </div>
          <div id="capture-view-div">
            <label>Use this link to share the view with colleagues</label>
            <input type="text" id="copy-link-text" readonly>
            <button id="copy-btn">Copy</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.5.1.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/powerbi-client@2.19.0/dist/powerbi.min.js"></script>

  <script>
    function createBookmarksList(bookmarks) {
      const list = document.getElementById("bookmarks-list");
      list.innerHTML = "";

      if (!bookmarks || bookmarks.length === 0) {
        const emptyItem = document.createElement("li");
        emptyItem.className = "dropdown-item";
        emptyItem.innerText = "No bookmarks available.";
        list.appendChild(emptyItem);
        return;
      }

      bookmarks.forEach(bookmark => {
        const item = document.createElement("li");
        item.className = "dropdown-item";
        item.innerText = bookmark.displayName;
        item.onclick = () => {
          bookmark.apply();
        };
        list.appendChild(item);
      });
    }

    $(document).ready(async function () {
      const models = window["powerbi-client"].models;

      const accessToken = "eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6IkNOdjBPSTNSd3FsSEZFVm5hb01Bc2hDSDJYRSIsImtpZCI6IkNOdjBPSTNSd3FsSEZFVm5hb01Bc2hDSDJYRSJ9.eyJhdWQiOiJodHRwczovL2FuYWx5c2lzLndpbmRvd3MubmV0L3Bvd2VyYmkvYXBpIiwiaXNzIjoiaHR0cHM6Ly9zdHMud2luZG93cy5uZXQvYWIxOTRlMDEtNmRjNy00YzZhLWJiYjEtNjhjMTJjNzQ0Yjk3LyIsImlhdCI6MTc1MDQ1NjUyNiwibmJmIjoxNzUwNDU2NTI2LCJleHAiOjE3NTA0NjE2NjEsImFjY3QiOjAsImFjciI6IjEiLCJhaW8iOiJBWFFBaS84WkFBQUF0TFhQdTk3M3FuNzJOMUtud2dGQUlmcUIwbE5mdU5oU01LbXhrM2dyMkFCY010L0oxNGp1dVgvdUxITWxXVk5GRUUwZitYVVRoT2IveHkrVGFscmR3Y2I2by9wVmhTTGdFUTA0LzNETmk4U2dpcy9wREFobElYeEZWaWxCbXpiZ0ZtYnAzcXZJK014R1RnQmpoSkdNUkE9PSIsImFtciI6WyJwd2QiXSwiYXBwaWQiOiJhODhhMTlhNC0yY2RhLTQ1NmMtOWZkYy05MjE4ZDAwMjdlZTIiLCJhcHBpZGFjciI6IjEiLCJmYW1pbHlfbmFtZSI6IkJpbGxpb3QiLCJnaXZlbl9uYW1lIjoiS2lyYnkiLCJpZHR5cCI6InVzZXIiLCJpcGFkZHIiOiI1NC44Ni41MC4xMzkiLCJuYW1lIjoiS2lyYnkgQmlsbGlvdCIsIm9pZCI6IjVhNzdjMGI3LTI4ZjAtNGFmMy04MGIxLWFjNmQwMTAxYzc2ZCIsInB1aWQiOiIxMDAzMjAwMDQ3NDhFNUZEIiwicmgiOiIxLkFUWUFBVTRacThkdGFreTdzV2pCTEhSTGx3a0FBQUFBQUFBQXdBQUFBQUFBQUFBMkFDODJBQS4iLCJzY3AiOiJEYXRhc2V0LlJlYWQuQWxsIFJlcG9ydC5SZWFkLkFsbCBUZW5hbnQuUmVhZC5BbGwgV29ya3NwYWNlLlJlYWQuQWxsIiwic2lkIjoiMDA1ZWEyYTktYzUwZC0xYjA0LTM1ZjMtNWFiNWQwNmU1OTg0Iiwic3ViIjoiRVViaFVXSDBVdG9SeUU3WFBLYVY5NkZXd1FWcEtZTl9XUjBXdk01R3k4VSIsInRpZCI6ImFiMTk0ZTAxLTZkYzctNGM2YS1iYmIxLTY4YzEyYzc0NGI5NyIsInVuaXF1ZV9uYW1lIjoiS2lyYnkuQmlsbGlvdEBzaGVsbGtleS5jb21wYW55IiwidXBuIjoiS2lyYnkuQmlsbGlvdEBzaGVsbGtleS5jb21wYW55IiwidXRpIjoiV3VFdDhyWmZCRVMxRGo1NWdPWXlBQSIsInZlciI6IjEuMCIsIndpZHMiOlsiNjJlOTAzOTQtNjlmNS00MjM3LTkxOTAtMDEyMTc3MTQ1ZTEwIiwiM2EyYzYyZGItNTMxOC00MjBkLThkNzQtMjNhZmZlZTVkOWQ1IiwiYTllYTg5OTYtMTIyZi00Yzc0LTk1MjAtOGVkY2QxOTI4MjZjIiwiYmUyZjQ1YTEtNDU3ZC00MmFmLWEwNjctNmVjMWZhNjNiYzQ1IiwiZTg2MTFhYjgtYzE4OS00NmU4LTk0ZTEtNjAyMTNhYjFmODE0IiwiYWMxNmU0M2QtN2IyZC00MGUwLWFjMDUtMjQzZmYzNTZhYjViIiwiMDk2NGJiNWUtOWJkYi00ZDdiLWFjMjktNThlNzk0ODYyYTQwIiwiMTE2NDg1OTctOTI2Yy00Y2YzLTljMzYtYmNlYmIwYmE4ZGNjIiwiNGE1ZDhmNjUtNDFkYS00ZGU0LTg5NjgtZTAzNWI2NTMzOWNmIiwiNWYyMjIyYjEtNTdjMy00OGJhLThhZDUtZDQ3NTlmMWZkZTZmIiwiNzkwYzFmYjktN2Y3ZC00Zjg4LTg2YTEtZWYxZjk1YzA1YzFiIiwiNzI5ODI3ZTMtOWMxNC00OWY3LWJiMWItOTYwOGYxNTZiYmI4IiwiMTU4YzA0N2EtYzkwNy00NTU2LWI3ZWYtNDQ2NTUxYTZiNWY3IiwiOTY2NzA3ZDAtMzI2OS00NzI3LTliZTItOGMzYTEwZjE5YjlkIiwiNWM0ZjlkY2QtNDdkYy00Y2Y3LThjOWEtOWU0MjA3Y2JmYzkxIiwiZjI4YTFmNTAtZjZlNy00NTcxLTgxOGItNmExMmYyYWY2YjZjIiwiN2JlNDRjOGEtYWRhZi00ZTJhLTg0ZDYtYWIyNjQ5ZTA4YTEzIiwiZmNmOTEwOTgtMDNlMy00MWE5LWI1YmEtNmYwZWM4MTg4YTEyIiwiMjkyMzJjZGYtOTMyMy00MmZkLWFkZTItMWQwOTdhZjNlNGRlIiwiNzU5NDEwMDktOTE1YS00ODY5LWFiZTctNjkxYmZmMTgyNzllIiwiNGQ2YWMxNGYtMzQ1My00MWQwLWJlZjktYTNlMGM1Njk3NzNhIiwiMmI3NDViZGYtMDgwMy00ZDgwLWFhNjUtODIyYzQ0OTNkYWFjIiwiOWI4OTVkOTItMmNkMy00NGM3LTlkMDItYTZhYzJkNWVhNWMzIiwiNzY5OGE3NzItNzg3Yi00YWM4LTkwMWYtNjBkNmIwOGFmZmQyIiwiNWQ2YjZiYjctZGU3MS00NjIzLWI0YWYtOTYzODBhMzUyNTA5IiwiNzQ5NWZkYzQtMzRjNC00ZDE1LWEyODktOTg3ODhjZTM5OWZkIiwiNjkwOTEyNDYtMjBlOC00YTU2LWFhNGQtMDY2MDc1YjJhN2E4IiwiNzRlZjk3NWItNjYwNS00MGFmLWE1ZDItYjk1MzlkODM2MzUzIiwiZjAyM2ZkODEtYTYzNy00YjU2LTk1ZmQtNzkxYWMwMjI2MDMzIiwiNDQzNjcxNjMtZWJhMS00NGMzLTk4YWYtZjU3ODc4NzlmOTZhIiwiY2YxYzM4ZTUtMzYyMS00MDA0LWE3Y2ItODc5NjI0ZGNlZDdjIiwiYjFiZTFjM2UtYjY1ZC00ZjE5LTg0MjctZjZmYTBkOTdmZWI5IiwiODgzNTI5MWEtOTE4Yy00ZmQ3LWE5Y2UtZmFhNDlmMGNmN2Q5IiwiYmFmMzdiM2EtNjEwZS00NWRhLTllNjItZDlkMWU1ZTg5MTRiIiwiMTk0YWU0Y2ItYjEyNi00MGIyLWJkNWItNjA5MWIzODA5NzdkIiwiZjcwOTM4YTAtZmMxMC00MTc3LTllOTAtMjE3OGY4NzY1NzM3IiwiMzhhOTY0MzEtMmJkZi00YjRjLThiNmUtNWQzZDhhYmFjMWE0IiwiYjBmNTQ2NjEtMmQ3NC00YzUwLWFmYTMtMWVjODAzZjEyZWZlIiwiZTZkMWEyM2EtZGExMS00YmU0LTk1NzAtYmVmYzg2ZDA2N2E3IiwiYzRlMzliZDktMTEwMC00NmQzLThjNjUtZmIxNjBkYTAwNzFmIiwiMTczMTU3OTctMTAyZC00MGI0LTkzZTAtNDMyMDYyY2FjYTE4IiwiZmRkN2E3NTEtYjYwYi00NDRhLTk4NGMtMDI2NTJmZThmYTFjIiwiZmU5MzBiZTctNWU2Mi00N2RiLTkxYWYtOThjM2E0OWEzOGIxIiwiOTVlNzkxMDktOTVjMC00ZDhlLWFlZTMtZDAxYWNjZjJkNDdiIiwiYjc5ZmJmNGQtM2VmOS00Njg5LTgxNDMtNzZiMTk0ZTg1NTA5Il0sInhtc19mdGQiOiJBR1J5aEJDTUNqb3ZDUXhsTDVNVEhTNjZlYm9RYzktTVh3T1h0MmpDNzA4QmRYTnpiM1YwYUMxa2MyMXoiLCJ4bXNfaWRyZWwiOiIxNCAxIiwieG1zX3BsIjoiZW4tVVMifQ.c-3U9p5UJ7Tvo_0SJK_fyyvScCoZBqXrfS85hnSae3dOE0fYThLgzmGNi2eogM73WGp4kKT8-AIuTIFRZVtCZpJFfMIAQGRutGOnqGziTrFNR3ilAM5JvjVlhELAltK6y8puIzTVL4MJWk_CR5BXjlqr0g8Gh7uVBSPfbx_kbt4A2akyF2g2Spl__MXDNH2YSOJt-M5dl2cGY2BtPEViAjXPsBJIz0HQLbKGGc4LfslRqfDQtlPDTObIB-H97OAJe2QUBQvZEvhBfT-kANntd1GIzFmnSYAHH6wV6ep8N8d7EVBZL7Sn6fk3vbVdKtAW2UenUUZUXNW8gZF9dbb09Q";
      const reportId = "3526c4f5-0314-47c3-9eed-e893321d00e6";
      const groupId = "1c4340de-2a85-40e5-8eb0-4f295368978b";

      const embedUrl = `https://app.powerbi.com/reportEmbed?reportId=${reportId}&groupId=${groupId}`;

      const config = {
        type: 'report',
        tokenType: models.TokenType.Aad,
        accessToken: accessToken,
        embedUrl: embedUrl,
        id: reportId,
        permissions: models.Permissions.All,
        settings: {
          panes: { filters: { visible: true }, pageNavigation: { visible: false } },
          layoutType: models.LayoutType.Custom,
          customLayout: {
            displayOption: models.DisplayOption.FitToWidth
          }
        }
      };

      const container = document.getElementById("report-container");
      powerbi.reset(container);

      const report = powerbi.embed(container, config);

      report.on("loaded", async () => {
        $("#overlay").addClass("invisible");
        $("#main-div").addClass("visible");
        try {
          const bookmarks = await report.bookmarksManager.getBookmarks();
          createBookmarksList(bookmarks);
        } catch (error) {
          console.error("Bookmark error", error);
        }
      });

      report.on("error", event => {
        console.error("Power BI Report Error:", event.detail);
      });
    });
  </script>

</body>
</html>

