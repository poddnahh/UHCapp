<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Capture Report Views</title>

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
  <link rel="stylesheet" href="/UHCapp/Capture%20report%20views/css/header.css">
  <link rel="stylesheet" href="/UHCapp/Capture%20report%20views/css/content.css">
  <link rel="stylesheet" href="/UHCapp/Capture%20report%20views/css/report.css">
  <link rel="stylesheet" href="/UHCapp/Capture%20report%20views/css/modal.css">
  <link rel="stylesheet" href="/UHCapp/Capture%20report%20views/css/sidebar.css">
</head>
<body>
  <div id="wrapper">
    <header id="contoso-header">
      <img src="/UHCapp/Capture%20report%20views/img/IconUnitedHealthcare.png" id="contoso" alt="UnitedHealthcare logo" />
      <span id="uhc-text">United Healthcare</span>
    </header>

    <nav id="sidebar">
      <a href="/UHCapp/Go%20from%20insights%20to%20quick%20action/">Go from Insights to Quick Action</a>
      <a href="/UHCapp/Capture%20report%20views/" class="active">Capture Report Views</a>
      <a href="/UHCapp/Customize%20report%20colors%20and%20mode/">Customize Report Colors and Mode</a>
      <a href="/UHCapp/Personalize%20top%20insights/">Personalize Top Insights</a>
      <a href="/UHCapp/Quickly%20create%20and%20personalize%20visuals/">Quickly Create and Personalize Visuals</a>
    </nav>

    <main id="main-div">
      <div class="interactive-buttons">
        <div class="bookmarks-dropdown">
          <button class="btn btn-action" type="button" id="display-btn" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            <img class="btn-img" src="/UHCapp/Capture%20report%20views/img/allviews.svg" alt="My views">Saved Views
          </button>
          <ul class="dropdown-menu checkbox-menu allow-focus" role="menu" id="bookmarks-list"></ul>
        </div>
        <div>
          <button class="btn btn-action" type="button" id="capture-btn" data-toggle="modal" data-target="#modal-action">
            <img class="btn-img" src="/UHCapp/Capture%20report%20views/img/captureview.svg" alt="Capture View">Capture View
          </button>
        </div>
      </div>

      <div role="separator" class="line"></div>
      <div id="overlay">
        <img src="/UHCapp/Capture%20report%20views/img/spinner.svg" id="spinner" class="rotate" alt="Loading report">
      </div>

      <div id="report-container"></div>
    </main>
  </div>

  <!-- Modal -->
  <div class="modal fade" id="modal-action" role="dialog">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">What would you like to do with this view?</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <img src="/UHCapp/Capture%20report%20views/img/cross.svg" alt="Close">
          </button>
        </div>
        <div class="modal-body">
          <button class="btn-modal btn-links btn-active" id="save-view-btn">Save to 'My Views'</button>
          <button class="btn-modal btn-links" id="copy-link-btn">Copy Link</button>
          <div id="save-view-div">
            <label for="viewname">Enter a name for this view:</label>
            <input type="text" id="viewname" placeholder="Example: Sales Report Q1">
            <button id="save-bookmark-btn">Save</button>
          </div>
          <div id="capture-view-div">
            <label>Use this link to share the view with colleagues</label>
            <input type="text" id="copy-link-text" readonly>
            <button id="copy-btn">Copy</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.5.1.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/powerbi-client@2.19.0/dist/powerbi.min.js"></script>

  <script>
    $(document).ready(async function () {
      const models = window["powerbi-client"].models;

      // Replace these with real values
      const accessToken = "YOUR_TOKEN_HERE"; // ⚠️ Insert a valid Power BI token
      const reportId = "YOUR_REPORT_ID";
      const groupId = "YOUR_GROUP_ID";

      const embedUrl = `https://app.powerbi.com/reportEmbed?reportId=${reportId}&groupId=${groupId}`;

      const config = {
        type: 'report',
        tokenType: models.TokenType.Aad,
        accessToken: accessToken,
        embedUrl: embedUrl,
        id: reportId,
        permissions: models.Permissions.All,
        settings: {
          panes: { filters: { visible: true }, pageNavigation: { visible: false } },
          layoutType: models.LayoutType.Custom,
          customLayout: {
            displayOption: models.DisplayOption.FitToWidth
          }
        }
      };

      // Clear container before embedding to avoid double embed
      const container = document.getElementById("report-container");
      powerbi.reset(container);

      const report = powerbi.embed(container, config);

      report.on("loaded", async () => {
        $("#overlay").addClass("invisible");
        $("#main-div").addClass("visible");
        try {
          const bookmarks = await report.bookmarksManager.getBookmarks();
          createBookmarksList(bookmarks);
        } catch (error) {
          console.error("Bookmark error", error);
        }
      });

      report.on("error", event => {
        console.error("Power BI Report Error:", event.detail);
      });
    });
  </script>

</body>
</html>
