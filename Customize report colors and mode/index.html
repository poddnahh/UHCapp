<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Minimal Embed Test</title>
  <style>
    body, html { margin:0; height:100%; }
    #overlay {
      position:fixed; top:0; left:0; right:0; bottom:0;
      display:flex; align-items:center; justify-content:center;
      background:rgba(255,255,255,0.8); z-index:100;
    }
    #report-container { width:100%; height:100%; }
  </style>
</head>
<body>
  <div id="overlay">
    <img src="../Go%20from%20insights%20to%20quick%20action/img/spinner.svg" alt="Loading…" />
  </div>
  <div id="report-container"></div>

  <!-- 1) Power BI client -->
  <script src="https://cdn.powerbi.com/libs/powerbi-client/2.19.1/powerbi.min.js"></script>

  <!-- 2) Minimal embed logic -->
  <script>
  (async function(){
    const overlay = document.getElementById("overlay");
    const container = document.getElementById("report-container");

    let list;
    try {
      const res = await fetch("reportList.json");
      if (!res.ok) throw new Error("HTTP " + res.status);
      list = await res.json();
    } catch(e) {
      overlay.innerHTML = "<div style='color:red'>reportList.json load error:<br>" + 
                           e.message + "</div>";
      return;
    }

    if (!list.length) {
      overlay.innerHTML = "<div style='color:red'>Empty reportList.json</div>";
      return;
    }
    // Always pick the first entry for now
    const entry = list[0];

    const models = window["powerbi-client"].models;
    const config = {
      type: "report",
      tokenType: models.TokenType.Embed,
      accessToken: "",            // public embed
      embedUrl: entry.embedUrl,
      settings: {
        panes: { filters:{visible:false}, pageNavigation:{visible:false} },
        background: models.BackgroundType.Transparent
      }
    };

    try {
      const report = powerbi.embed(container, config);
      report.on("loaded", () => {
        overlay.style.display = "none";
        console.log("✅ Embedded:", entry.name);
      });
      report.on("error", err => {
        console.error(err);
        overlay.innerHTML = "<div style='color:red'>Embed error:<br>" + 
                             err.message + "</div>";
      });
    } catch(err) {
      console.error(err);
      overlay.innerHTML = "<div style='color:red'>Embed exception:<br>" + 
                           err.message + "</div>";
    }
  })();
  </script>
</body>
</html>
